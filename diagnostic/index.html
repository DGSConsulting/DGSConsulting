<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DGS Consulting | Tech Stack Profit Leak Diagnostic</title>

<!-- DGS Consulting Colors -->
<style>
:root {
  --bg: #fbfdfe;
  --ink: #0f1724;
  --accent: #06B6D4;
  --accent-700: #0891b2;
  --muted: #6b7280;
  --card: #ffffff;
  --font: 'Inter', sans-serif;
}

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--ink);
  margin: 0;
  padding: 0;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.card {
  background: var(--card);
  border-radius: 12px;
  padding: 30px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  margin-bottom: 20px;
}

h1,h2,h3 { margin: 0 0 15px 0; }

button {
  background: var(--accent);
  border: none;
  color: #fff;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  margin: 5px;
}
button:hover {
  background: var(--accent-700);
}

.progress-container {
  background: #e5e7eb;
  border-radius: 12px;
  height: 12px;
  margin-bottom: 20px;
  overflow: hidden;
}
.progress-bar {
  height: 100%;
  width: 0%;
  background: var(--accent);
  transition: width 0.3s;
}

.completion-percent {
  font-size: 0.85rem;
  color: var(--muted);
  float: right;
  margin-top: -20px;
}

.form-section {
  display: none;
}
.form-section.active {
  display: block;
}

#errorMessage {
  color: red;
  display: none;
  margin-bottom: 10px;
}

#loadingScreen {
  display: none;
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.5);
  color: #fff;
  font-size: 24px;
  text-align: center;
  padding-top: 200px;
  z-index: 9999;
}
</style>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-T0K5M8P9XP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-T0K5M8P9XP');
</script>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<div class="container card">
  <h1>Tech Stack Profit Leak Diagnostic</h1>
  <p>Welcome! This diagnostic helps identify where your business is losing money and time in software subscriptions.</p>

  <div class="progress-container">
    <div id="progressBar" class="progress-bar"></div>
  </div>

  <div id="errorMessage"></div>

  <form id="diagnosticForm">
    <!-- Section 1 -->
    <div class="form-section active" data-section="1">
      <h2>Section 1: Business Overview <span class="completion-percent">0%</span></h2>
      <label>Business Name <input type="text" name="business_name" required></label><br><br>
      <label>Email <input type="email" name="email" required></label><br><br>
      <button type="button" onclick="nextSection()">Next</button>
    </div>

    <!-- Section 2 -->
    <div class="form-section" data-section="2">
      <h2>Section 2: Software Usage <span class="completion-percent">0%</span></h2>
      <label>Number of software subscriptions <input type="number" name="software_count" required></label><br><br>
      <label>Most used software <input type="text" name="most_used_software" required></label><br><br>
      <button type="button" onclick="prevSection()">Back</button>
      <button type="button" onclick="nextSection()">Next</button>
    </div>

    <!-- Section 3 -->
    <div class="form-section" data-section="3">
      <h2>Section 3: Productivity Issues <span class="completion-percent">0%</span></h2>
      <label>Time wasted per week <input type="text" name="time_wasted" required></label><br><br>
      <label>Biggest bottleneck <input type="text" name="bottleneck" required></label><br><br>
      <button type="button" onclick="prevSection()">Back</button>
      <button type="button" onclick="nextSection()">Next</button>
    </div>

    <!-- Section 4 -->
    <div class="form-section" data-section="4">
      <h2>Section 4: Cost Assessment <span class="completion-percent">0%</span></h2>
      <label>Monthly software spend <input type="number" name="monthly_spend" required></label><br><br>
      <label>Unused subscriptions <input type="text" name="unused_subscriptions" required></label><br><br>
      <button type="button" onclick="prevSection()">Back</button>
      <button type="button" onclick="nextSection()">Next</button>
    </div>

    <!-- Section 5 -->
    <div class="form-section" data-section="5">
      <h2>Section 5: Goals <span class="completion-percent">0%</span></h2>
      <label>Top 3 software goals <input type="text" name="software_goals" required></label><br><br>
      <label>Additional notes <textarea name="notes"></textarea></label><br><br>
      <button type="button" onclick="prevSection()">Back</button>
      <button type="button" onclick="nextSection()">Submit</button>
    </div>

    <!-- Success Section -->
    <div class="form-section" data-section="success">
      <h2>Thank you!</h2>
      <p>Your diagnostic has been submitted successfully. Check your PDF download.</p>
    </div>
  </form>
</div>

<div id="loadingScreen">Submitting...</div>

<script>
// Sections
let currentSection = 1;
const totalSections = 5;

// Update Progress
function updateProgress(){
  const sections = document.querySelectorAll('.form-section[data-section]');
  let filledFields=0, totalFields=0;
  sections.forEach(sec=>{
    const req = sec.querySelectorAll('[required]');
    req.forEach(f=>{
      totalFields++;
      if(f.type==='checkbox' && f.checked) filledFields++;
      else if(f.value.trim()!=='') filledFields++;
    });
  });
  const percent=Math.round((filledFields/totalFields)*100);
  document.getElementById('progressBar').style.width = percent + '%';
}

// Track Analytics
function trackSectionEvent(action){
  gtag('event', 'diagnostic_section', {
    'event_category': 'Diagnostic',
    'event_action': action,
    'event_label': 'Section ' + currentSection
  });
}

// Show Section
function showSection(sectionNum){
  document.querySelectorAll('.form-section').forEach(s=>s.classList.remove('active'));
  const target=document.querySelector(`.form-section[data-section="${sectionNum}"]`);
  if(target) target.classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
  updateSectionCompletion(sectionNum);
  trackSectionEvent('view');
}

// Validate Current Section
function validateCurrentSection(){
  const currentEl=document.querySelector(`[data-section="${currentSection}"]`);
  const requiredFields=currentEl.querySelectorAll('[required]');
  let valid=true;
  requiredFields.forEach(f=>{
    if(f.type==='checkbox'){
      const checkboxes=currentEl.querySelectorAll(`input[name="${f.name}"]`);
      if(!Array.from(checkboxes).some(cb=>cb.checked)) valid=false;
    } else if(!f.value.trim()) valid=false;
  });
  if(!valid) showError('Please fill in all required fields');
  return valid;
}

// Navigation
function nextSection(){
  if(!validateCurrentSection()) return;
  trackSectionEvent('next');
  if(currentSection<totalSections) currentSection++;
  else submitForm();
  showSection(currentSection);
  updateProgress();
}
function prevSection(){
  if(currentSection>1){
    trackSectionEvent('back');
    currentSection--;
    showSection(currentSection);
    updateProgress();
  }
}

// Error Handling
function showError(msg){
  const e=document.getElementById('errorMessage');
  e.textContent=msg;
  e.style.display='block';
  setTimeout(()=>{e.style.display='none';},5000);
}

// Section Completion Percent
function updateSectionCompletion(sectionNumber){
  const section=document.querySelector(`.form-section[data-section="${sectionNumber}"]`);
  const requiredFields=section.querySelectorAll('[required]');
  if(requiredFields.length===0) return;
  let filled=0;
  requiredFields.forEach(f=>{
    if(f.type==='checkbox'){if(f.checked) filled++;}
    else if(f.value.trim()!=='') filled++;
  });
  const percent=Math.round((filled/requiredFields.length)*100);
  section.querySelector('.completion-percent').textContent=percent+'%';
  updateProgress();
}

// Listen to Inputs
document.querySelectorAll('#diagnosticForm [required]').forEach(f=>{
  f.addEventListener('input',()=>updateSectionCompletion(f.closest('.form-section').dataset.section));
});

// PDF generation
function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const formData = new FormData(document.getElementById('diagnosticForm'));
  let y=10;
  formData.forEach((value,key)=>{
    doc.text(`${key}: ${value}`, 10, y);
    y+=10;
  });
  doc.save('diagnostic.pdf');
}

// Submit Form
function submitForm(){
  const form=document.getElementById('diagnosticForm');
  const loading=document.getElementById('loadingScreen');
  loading.style.display='block';
  const formData=new FormData(form);
  fetch('https://script.google.com/macros/s/AKfycbwqscJy619uOduBAMRBZjM-PbuJK_rrDdPMwCDgUyFfDspP2DC2nzSYhwibirqKzYMeiQ/exec',{
    method:'POST',
    body: formData
  }).then(res=>{
    loading.style.display='none';
    currentSection='success';
    showSection('success');
    downloadPDF();
    trackSectionEvent('submit');
  }).catch(err=>{
    loading.style.display='none';
    showError('Submission failed. Please try again.');
    trackSectionEvent('submission_failed');
  });
}

// Initialize
updateProgress();
showSection(currentSection);
</script>
</body>
</html>
