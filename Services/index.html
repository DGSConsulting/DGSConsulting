<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fix Your Systems, Not Add More Tools — DGS Consulting</title>
<meta name="description" content="We find the waste in your existing systems and stop the bleed — no new software unless it actually helps. Free Red Flag Audit for qualifying businesses.">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-T0K5M8P9XP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-T0K5M8P9XP');
</script>

<style>
:root{
  --bg:#fbfdfe;
  --ink:#0f1724;              /* slate / primary */
  --accent:#06b6d4;           /* cyan */
  --accent-700:#0891b2;
  --muted:#6b7280;            /* neutral text */
  --card:#ffffff;
  --success:#10b981;
  --danger:#ef4444;
  --radius:14px;
  --maxw:1100px;
  --pad:20px;
  --focus: 3px solid rgba(6,182,212,0.14);
  font-size:16px;
}
*{box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0; background:var(--bg); color:var(--ink); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; line-height:1.5}
.container{max-width:var(--maxw);margin:0 auto;padding:0 var(--pad)}

/* NAV */
.header {
  position:sticky; top:0; z-index:80;
  backdrop-filter: blur(6px);
  background: linear-gradient(180deg, rgba(11,20,32,0.88), rgba(11,20,32,0.82));
  box-shadow: 0 6px 20px rgba(2,6,23,0.12);
}
.header-inner{display:flex;align-items:center;justify-content:space-between;gap:16px;max-width:var(--maxw);margin:0 auto;padding:14px var(--pad)}
.logo{height:44px;filter:brightness(0) invert(1)}
.nav{display:flex;gap:12px}
.nav a{color:white;text-decoration:none;padding:8px 12px;border-radius:10px;font-weight:600;font-size:0.95rem}

/* HERO (premium, calm) */
.hero {
  display:grid;
  grid-template-columns:1fr 380px;
  gap:28px;
  align-items:center;
  padding:68px 0 42px;
}
@media (max-width:920px){.hero{grid-template-columns:1fr;padding:48px 0 36px}}
.h-title{font-size:2.05rem;line-height:1.04;margin:0 0 12px;font-weight:700;max-width:56ch}
.h-sub{color:var(--muted);font-size:1rem;margin-bottom:18px}
.primary-cta{background:var(--accent);color:white;border:0;padding:12px 18px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:0 12px 30px rgba(6,182,212,0.12)}
.primary-cta:hover{background:var(--accent-700);transform:translateY(-3px)}
.tertiary{background:transparent;border:1px solid rgba(255,255,255,0.12);color:white;padding:9px 14px;border-radius:10px;text-decoration:none;font-weight:700}

/* LEAD CARD (right column) */
.lead-card{background:linear-gradient(180deg,#ffffff, #fbffff);border-radius:var(--radius);padding:22px;box-shadow:0 16px 40px rgba(2,6,23,0.06);border:1px solid rgba(6,182,212,0.06)}
.lead-sub{color:var(--muted);font-size:0.95rem;margin-bottom:10px}
.lead-value{font-weight:700;font-size:1.05rem;margin-bottom:6px}
.lead-price{font-size:1.5rem;color:var(--danger);font-weight:700;margin:10px 0}
.lead-cta{width:100%;padding:12px;border-radius:12px;border:0;background:var(--ink);color:white;font-weight:700;cursor:pointer}
.note{font-size:0.9rem;color:var(--muted);margin-top:10px}

/* PROBLEMS (three cards) */
.section{padding:42px 0}
.section h2{margin:0 0 18px;font-size:1.25rem}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
@media (max-width:880px){.grid-3{grid-template-columns:1fr}}
.card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.04);border-left:4px solid #fdecea}
.card h3{margin:0 0 8px;color:var(--danger);font-size:1rem}
.card p{margin:0;color:var(--muted)}

/* QUIZ area — left panel + right summary sticky */
.quiz-wrap{display:grid;grid-template-columns:1fr 340px;gap:28px;align-items:start;padding:36px 0}
@media (max-width:920px){.quiz-wrap{grid-template-columns:1fr;padding:28px 0}}
.panel{background:var(--card);padding:22px;border-radius:12px;box-shadow:0 12px 30px rgba(2,6,23,0.04)}
.panel h3{margin:0 0 8px;font-size:1.15rem}
.leadline{color:var(--muted);margin-bottom:12px}
.question{margin-bottom:14px}
.options{display:flex;flex-direction:column;gap:10px}
.option{background:#fbffff;border:1px solid #e6eef0;padding:12px;border-radius:10px;cursor:pointer;transition:all .16s;text-align:left}
.option:hover{transform:translateX(6px);border-color:var(--accent);background:#ecfeff}
.option strong{display:block}
.progress{height:8px;background:#e6eef0;border-radius:999px;overflow:hidden;margin-top:14px}
.progress-bar{height:100%;width:0;background:var(--accent);transition:width .28s}

/* recommendation card (sticky) */
.recommend{position:sticky;top:88px}
.recommend .card{background:linear-gradient(135deg,#ecfeff 0%, #cffafe 100%);border:2px solid var(--accent);padding:18px}
.recommend h4{margin:0 0 8px;color:var(--ink)}
.recommend p{margin:0 0 10px;color:var(--muted)}
.recommend ul{margin:10px 0 0 16px;padding:0}
.recommend li{margin-bottom:8px;color:var(--ink)}
.recommend .price{font-weight:700;margin-top:10px}

/* PROOF */
.proof {padding:42px 0}
.proof-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
@media (max-width:880px){.proof-grid{grid-template-columns:1fr}}
.proof-card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 12px 30px rgba(2,6,23,0.04);border-top:4px solid var(--accent)}
.proof .industry{font-size:0.75rem;color:var(--accent);font-weight:700;text-transform:uppercase;letter-spacing:0.6px;margin-bottom:8px}
.proof .metrics{background:#f1fafe;padding:10px;border-radius:8px;margin:10px 0;color:var(--ink)}

/* PROCESS */
.process{padding:36px 0}
.timeline{display:grid;gap:12px;max-width:880px;margin:0 auto}
.step{display:flex;gap:12px;align-items:flex-start;background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 20px rgba(2,6,23,0.04)}
.step-num{width:44px;height:44px;border-radius:10px;background:var(--accent);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}

/* GUARANTEE & CTA */
.guarantee{background:linear-gradient(135deg,#ecfdf5 0%, #d1fae5 100%);padding:26px;border-radius:12px;text-align:center}
.final-cta{background:linear-gradient(135deg,var(--ink) 0%, rgba(6,182,212,0.08) 100%);color:white;padding:48px 0;text-align:center}
.final-cta h3{margin:0 0 10px;font-size:1.3rem}

/* FOOTER */
footer{padding:28px 0;text-align:center;background:transparent;color:var(--muted)}
footer a{color:var(--accent);text-decoration:none}

/* MODAL & FORM */
.modal{display:none;position:fixed;inset:0;background:rgba(7,10,15,0.6);align-items:center;justify-content:center;z-index:120}
.modal.active{display:flex}
.modal-card{background:var(--card);width:95%;max-width:760px;border-radius:14px;padding:22px;box-shadow:0 30px 90px rgba(2,6,23,0.6);max-height:92vh;overflow:auto}
.modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.close{background:none;border:0;font-size:22px;cursor:pointer;color:var(--muted)}
.form-row{margin-bottom:12px}
.form-row label{display:block;font-weight:600;margin-bottom:6px}
.form-row input,.form-row textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #e6eef0;font-size:1rem}
.form-row input:focus,.form-row textarea:focus{outline:none;box-shadow:var(--focus)}
.btn-primary{background:var(--accent);color:white;padding:12px;border-radius:12px;border:0;cursor:pointer;font-weight:700}
.btn-ghost{background:#f1f5f9;padding:10px;border-radius:10px;border:0;cursor:pointer}

/* accessibility */
button:focus,input:focus,textarea:focus{outline:none;box-shadow:var(--focus)}

/* small screens */
@media (max-width:640px){
  .hero{grid-template-columns:1fr;gap:18px;padding:36px 0}
  .lead-card{order:2}
  .recommend{position:static}
  .quiz-wrap{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- HEADER / NAV -->
<header class="header" role="banner">
  <div class="header-inner container" role="navigation" aria-label="Main">
    <img class="logo" src="https://raw.githubusercontent.com/DGSConsulting/DGSConsulting/main/asset/logo-mark-t.png" alt="DGS Consulting logo">
    <nav class="nav" aria-label="Primary">
      <a href="../index.html">Home</a>
      <a href="../Services/index.html">Services</a>
      <a href="../case-studies/index.html">Case Studies</a>
      <a href="../Intake/index.html">Contact</a>
    </nav>
  </div>
</header>

<!-- HERO -->
<section class="hero container" aria-labelledby="heroTitle">
  <div>
    <h1 id="heroTitle" class="h-title">Fix your systems, not add more tools</h1>
    <p class="h-sub">Most service businesses quietly lose $10K–$50K a year to duplicated subscriptions, missed invoices, and manual chaos. We find the leaks and stop the waste — without forcing new software on your team.</p>

    <div style="display:flex;gap:12px;flex-wrap:wrap">
      <button class="primary-cta" onclick="document.getElementById('quiz').scrollIntoView({behavior:'smooth'})">Start the 2-minute assessment</button>
      <a class="tertiary" href="#caseStudies">See real results</a>
    </div>

    <p style="color:var(--muted);margin-top:12px;font-size:0.95rem">Free Red Flag Audit for qualifying businesses • No pitch • Immediate recommendation</p>
  </div>

  <aside class="lead-card" aria-labelledby="leadTitle">
    <div id="leadTitle" class="lead-value">Free Red Flag Audit — normally $250</div>
    <div class="lead-sub">A focused audit that finds waste, shows one high-impact fix you can implement this week, and estimates savings.</div>
    <div class="lead-price lead-price">$0</div>
    <button class="lead-cta" onclick="document.getElementById('quiz').scrollIntoView({behavior:'smooth'})">Claim my audit</button>
    <div class="note">Guarantee: If we don’t find at least $2,000/yr in identifiable waste, the audit is free.</div>
  </aside>
</section>

<!-- PROBLEMS -->
<section class="section container" aria-labelledby="probs">
  <h2 id="probs" style="text-align:center">What’s actually costing your business</h2>
  <div class="grid-3" style="margin-top:18px">
    <div class="card">
      <h3>Redundant subscriptions</h3>
      <p>Multiple tools doing the same job — quietly billing every month and creating confusion for your team.</p>
    </div>
    <div class="card">
      <h3>Lost billable time</h3>
      <p>Manual handoffs, missing timesheets, late invoices. 10–15 lost hours each week is common in service teams.</p>
    </div>
    <div class="card">
      <h3>Owner as bottleneck</h3>
      <p>Decisions, approvals, and fixes all land on you. Your business can’t scale until the system runs without you.</p>
    </div>
  </div>
</section>

<!-- QUIZ & RECOMMENDATION -->
<section id="quiz" class="quiz-wrap container" aria-labelledby="quizTitle">
  <!-- left: quiz -->
  <div class="panel" aria-live="polite">
    <h3 id="quizTitle">Two minutes. Three simple questions. One clear next step.</h3>
    <p class="leadline">Answer quickly — we’ll recommend the right next step: a Red Flag Audit, Power Sessions, or a full transformation.</p>

    <!-- Q1 -->
    <div class="question" data-q="1">
      <div style="font-weight:700;margin-bottom:8px">1 — Annual revenue</div>
      <div class="options" role="list">
        <div class="option" role="listitem" data-value="under500k"><strong>Under $500K</strong><span style="display:block;color:var(--muted)">Solo or very small team</span></div>
        <div class="option" role="listitem" data-value="500k-2m"><strong>$500K–$2M</strong><span style="display:block;color:var(--muted)">Growing team, hitting scale issues</span></div>
        <div class="option" role="listitem" data-value="over2m"><strong>Over $2M</strong><span style="display:block;color:var(--muted)">Established — systems need overhaul</span></div>
      </div>
    </div>

    <!-- Q2 -->
    <div class="question" data-q="2" style="display:none">
      <div style="font-weight:700;margin-bottom:8px">2 — Biggest pain right now</div>
      <div class="options">
        <div class="option" role="listitem" data-value="waste"><strong>Wasting money</strong><span style="display:block;color:var(--muted)">Subscriptions I don't trust</span></div>
        <div class="option" role="listitem" data-value="chaos"><strong>Daily chaos</strong><span style="display:block;color:var(--muted)">Scheduling, invoices, firefighting</span></div>
        <div class="option" role="listitem" data-value="bottleneck"><strong>I'm the bottleneck</strong><span style="display:block;color:var(--muted)">Everything needs me</span></div>
      </div>
    </div>

    <!-- Q3 -->
    <div class="question" data-q="3" style="display:none">
      <div style="font-weight:700;margin-bottom:8px">3 — How fast do you need results?</div>
      <div class="options">
        <div class="option" role="listitem" data-value="exploring"><strong>Just exploring</strong><span style="display:block;color:var(--muted)">Want to understand options</span></div>
        <div class="option" role="listitem" data-value="soon"><strong>Within 30 days</strong><span style="display:block;color:var(--muted)">Need quick fixes</span></div>
        <div class="option" role="listitem" data-value="urgent"><strong>Urgent</strong><span style="display:block;color:var(--muted)">Revenue or sanity at risk</span></div>
      </div>
    </div>

    <div class="progress" aria-hidden="true"><div class="progress-bar" id="progressBar" style="width:0%"></div></div>
  </div>

  <!-- right: recommendation -->
  <aside class="recommend">
    <div class="card panel">
      <h4 id="resultTitle">Your recommendation will appear here</h4>
      <p style="color:var(--muted);margin-top:6px">Finish the three questions and we’ll show a short, practical next step — plus the exact offer that fits your situation.</p>

      <ul id="recList" style="display:none;margin-top:12px"></ul>
      <div id="recPrice" style="font-weight:700;margin-top:10px"></div>

      <div style="margin-top:12px">
        <button id="recBtn" class="btn-primary" onclick="openModalFromRec()" disabled>Get my recommendation</button>
      </div>

      <div style="margin-top:12px;font-size:0.95rem;color:var(--muted)">
        <strong>Need a quick call?</strong> Book a 20-minute Red Flag Call — no pitch, just clarity.
      </div>
    </div>
  </aside>
</section>

<!-- CASE STUDIES / PROOF -->
<section id="caseStudies" class="proof container" aria-label="Case studies">
  <h2 style="text-align:center">Results from businesses like yours</h2>
  <div class="proof-grid" style="margin-top:18px">
    <article class="proof-card">
      <div class="industry">Landscaping</div>
      <h4>From $1.5M → $4M in 18 months</h4>
      <div class="metrics"><strong>167% growth</strong><div style="color:var(--muted)">Increased capacity without doubling staff</div></div>
      <p style="color:var(--muted);margin-top:8px">"DGS gave us back control. For the first time we had systems we could trust." — Mark R.</p>
      <a href="../case-studies/Landscaping.html">Read case study →</a>
    </article>

    <article class="proof-card">
      <div class="industry">Tree Care</div>
      <h4>Reclaimed 104 hours/year</h4>
      <div class="metrics"><strong>$18K increase</strong><div style="color:var(--muted)">Faster quotes, better follow-up</div></div>
      <p style="color:var(--muted);margin-top:8px">"I'm doing less admin and making more money." — Mike</p>
      <a href="../case-studies/Arborist.html">Read case study →</a>
    </article>

    <article class="proof-card">
      <div class="industry">Auto Repair</div>
      <h4>120 hours/month saved</h4>
      <div class="metrics"><strong>$23,400</strong><div style="color:var(--muted)">Annual savings from streamlined admin</div></div>
      <p style="color:var(--muted);margin-top:8px">"Now I can actually plan my week." — James</p>
      <a href="../case-studies/Auto-Shop.html">Read case study →</a>
    </article>
  </div>
</section>

<!-- PROCESS -->
<section class="process container" aria-labelledby="processTitle">
  <h2 id="processTitle" style="text-align:center">How we actually fix your systems</h2>
  <p style="text-align:center;color:var(--muted);max-width:820px;margin:8px auto 18px">Audit first. Quick wins next. Automate what helps. Train your team. You own everything — no vendor lock-in.</p>

  <div class="timeline" aria-hidden="false">
    <div class="step"><div class="step-num">1</div><div><strong>Audit everything</strong><div style="color:var(--muted);margin-top:6px">Shadow operations and map workflows (Week 1–2).</div></div></div>
    <div class="step"><div class="step-num">2</div><div><strong>Cut the waste</strong><div style="color:var(--muted);margin-top:6px">Consolidate tools, create SOPs, quick wins (Week 3–4).</div></div></div>
    <div class="step"><div class="step-num">3</div><div><strong>Connect what stays</strong><div style="color:var(--muted);margin-top:6px">Automate data flow and remove manual steps (Week 5–6).</div></div></div>
    <div class="step"><div class="step-num">4</div><div><strong>Train & transfer</strong><div style="color:var(--muted);margin-top:6px">Team training, accountability checkpoints, 90-day support (Week 7–8).</div></div></div>
  </div>
</section>

<!-- GUARANTEE -->
<section class="section container" aria-labelledby="guar">
  <div class="guarantee">
    <h3 id="guar" style="margin:0 0 8px">Our guarantee</h3>
    <p style="margin:0;color:var(--muted)">If we don’t identify at least $2,000/year in waste during your audit, you owe nothing. Unsatisfied after the first session? We refund 50% — no drama.</p>
  </div>
</section>

<!-- FINAL CTA -->
<section class="final-cta">
  <div class="container">
    <h3>Stop losing $10K–$50K a year to broken systems</h3>
    <p style="color:rgba(255,255,255,0.92);max-width:720px;margin:10px auto 18px">Take two minutes. Get a practical recommendation and a free Red Flag Audit if we’re a fit.</p>
    <button class="primary-cta" onclick="document.getElementById('quiz').scrollIntoView({behavior:'smooth'})">Start the assessment</button>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <div class="container" style="padding-top:18px">
    <img src="https://raw.githubusercontent.com/DGSConsulting/DGSConsulting/main/asset/logo-mark-t.png" alt="DGS Consulting" style="height:38px;filter:brightness(0) invert(1);margin-bottom:8px">
    <div style="font-weight:700;margin-bottom:6px">DGS Consulting — Clarity over complexity</div>
    <div style="color:var(--muted);margin-bottom:8px">Founded by Darren Snook | Ottawa, ON</div>
    <div style="margin-bottom:8px"><a href="../index.html">Home</a> • <a href="../Services/index.html">Services</a> • <a href="../case-studies/index.html">Case Studies</a></div>
    <div style="color:var(--muted);font-size:0.95rem;margin-top:6px"><a href="mailto:DGSConsult@consultant.com">DGSConsult@consultant.com</a> • <a href="https://www.linkedin.com/in/dg-snook/">LinkedIn</a></div>
    <div style="color:var(--muted);font-size:0.85rem;margin-top:10px">© 2025 DGS Consulting. All rights reserved.</div>
  </div>
</footer>

<!-- MODAL: form remains; confirmation shows booking CTA which opens a prefilled youcanbook.me link in a NEW TAB -->
<div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-card" role="document">
    <div class="modal-head">
      <h3 id="modalTitle" style="margin:0">Book your Free Red Flag Audit</h3>
      <button class="close" aria-label="Close" onclick="closeModal()">×</button>
    </div>

    <!-- FORM (Formspree) -->
    <form id="leadForm" action="https://formspree.io/f/mldopknb" method="POST" style="margin-top:10px">
      <div class="form-row">
        <label for="name">Name</label>
        <input id="fld_name" name="name" type="text" required />
      </div>

      <div class="form-row">
        <label for="email">Email</label>
        <input id="fld_email" name="email" type="email" required />
      </div>

      <div class="form-row">
        <label for="phone">Phone (optional)</label>
        <input id="fld_phone" name="phone" type="tel" />
      </div>

      <div class="form-row">
        <label for="service">Recommended service</label>
        <input id="fld_service" name="service" readonly />
      </div>

      <input type="hidden" id="fld_quiz" name="quiz_results" />

      <div class="form-row">
        <label for="message">Tell us the single biggest pain right now</label>
        <textarea id="fld_message" name="message" rows="4" required placeholder="What's costing you time or money?"></textarea>
      </div>

      <div style="display:flex;gap:10px;align-items:center">
        <button class="btn-primary" type="submit">Send my assessment</button>
        <button type="button" class="btn-ghost" onclick="openBookingBeforeSubmit()">Book now instead</button>
      </div>
    </form>

    <!-- Confirmation (shown after successful submit) -->
    <div id="confirm" style="display:none;margin-top:14px">
      <h4 style="color:var(--success);margin:0 0 6px">Assessment sent</h4>
      <p style="color:var(--muted);margin:0 0 12px">We’ll review your answers and email next steps within 24 hours. Want to schedule now?</p>
      <div style="display:flex;gap:10px">
        <a id="bookNowLink" class="btn-primary" href="#" target="_blank" rel="noopener">Book My Audit — Open booking</a>
        <button class="btn-ghost" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== QUIZ LOGIC (streamlined) ===== */
const state = { revenue:null, pain:null, urgency:null };
const questions = Array.from(document.querySelectorAll('.question'));
const progressBar = document.getElementById('progressBar');
const recBtn = document.getElementById('recBtn');
const recList = document.getElementById('recList');
const recPrice = document.getElementById('recPrice');
const resultTitle = document.getElementById('resultTitle');

function showQuestion(i){
  questions.forEach((q, idx) => q.style.display = idx === i ? '' : 'none');
  const pct = Math.round((i / (questions.length - 1)) * 100);
  progressBar.style.width = pct + '%';
}
showQuestion(0);

document.querySelectorAll('.option').forEach(opt => {
  opt.addEventListener('click', () => {
    const qIndex = Number(opt.closest('.question').dataset.q) - 1;
    const val = opt.dataset.value;
    if(qIndex === 0) state.revenue = val;
    if(qIndex === 1) state.pain = val;
    if(qIndex === 2) state.urgency = val;

    // visual selection
    opt.parentElement.querySelectorAll('.option').forEach(o => o.style.boxShadow = 'none');
    opt.style.boxShadow = '0 8px 24px rgba(2,6,23,0.06)';

    if(qIndex < questions.length - 1){
      setTimeout(() => showQuestion(qIndex + 1), 140);
    } else {
      setTimeout(displayRecommendation, 140);
    }
  });
});

function displayRecommendation(){
  questions.forEach(q => q.style.display = 'none');
  progressBar.style.width = '100%';
  const rec = computeRecommendation(state);
  resultTitle.textContent = rec.title;
  recList.style.display = 'block';
  recList.innerHTML = '';
  rec.includes.forEach(i => {
    const li = document.createElement('li'); li.textContent = i; recList.appendChild(li);
  });
  recPrice.textContent = rec.price;
  recBtn.disabled = false;
  recBtn.textContent = rec.cta;
  recBtn.onclick = () => openModal(rec.service);
}

/* business logic for mapping quiz -> offer */
function computeRecommendation({ revenue, pain, urgency }) {
  if(!revenue || !pain || !urgency) {
    return { title: 'Power Sessions — quick, high-value fixes', includes: ['2×2-hour implementation sessions','Custom SOPs & templates','30 days email support'], price: '$1,997', cta: 'Book Power Sessions', service: 'Power Sessions Package' };
  }
  if(urgency === 'exploring' || revenue === 'under500k') {
    return { title: 'Tech Stack Red Flag Audit', includes: ['90-minute deep dive','1 page prioritized list','ROI estimate and next steps'], price: 'Free (Normally $250)', cta: 'Claim Free Audit', service: 'Tech Stack Red Flag Audit' };
  }
  if(revenue === '500k-2m' && (urgency === 'soon' || pain === 'chaos')) {
    return { title: 'Power Sessions Package', includes: ['Three 2-hour implementation sessions','Custom SOPs & templates','30 days email support'], price: '$1,997', cta: 'Get Started', service: 'Power Sessions Package' };
  }
  if(revenue === 'over2m' || urgency === 'urgent' || pain === 'bottleneck') {
    return { title: 'Complete Systems Transformation', includes: ['Full audit','Workflow documentation','Integrations & automations','Team training + 90d support'], price: '$4K–$8K', cta: 'Apply Now', service: 'Complete Systems Transformation' };
  }
  return { title: 'Power Sessions Package', includes: ['Three 2-hour implementation sessions','Custom SOPs & templates','30 days email support'], price: '$1,997', cta: 'Get Started', service: 'Power Sessions Package' };
}

/* ===== MODAL + FORM (Option B) ===== */
const modal = document.getElementById('modal');
const leadForm = document.getElementById('leadForm');
const fldName = document.getElementById('fld_name');
const fldEmail = document.getElementById('fld_email');
const fldService = document.getElementById('fld_service');
const fldQuiz = document.getElementById('fld_quiz');
const confirmBox = document.getElementById('confirm');
const bookNowLink = document.getElementById('bookNowLink');

function openModal(service){
  fldService.value = service || computeRecommendation(state).service;
  fldQuiz.value = JSON.stringify(state);
  modal.classList.add('active');
  setTimeout(()=> fldName.focus(), 120);
  try { gtag('event','open_modal',{event_category:'Lead',event_label:fldService.value}); } catch(e){}
}

function openModalFromRec(){
  const rec = computeRecommendation(state);
  openModal(rec.service);
}

function closeModal(){
  modal.classList.remove('active');
  leadForm.style.display = ''; // in case hidden after submit
  confirmBox.style.display = 'none';
  // reset booking link
  bookNowLink.href = '#';
}

/* If a user wants to book before submitting the form (Book now instead) */
function openBookingBeforeSubmit(){
  // ensure service field is set and quiz captured
  fldService.value = fldService.value || computeRecommendation(state).service;
  fldQuiz.value = JSON.stringify(state);

  // build prefilled booking URL
  const name = fldName.value || '';
  const email = fldEmail.value || '';
  const service = fldService.value || computeRecommendation(state).service;
  const bookingUrl = buildBookingUrl(name, email, service);

  // open new tab with prefilled fields
  window.open(bookingUrl, '_blank', 'noopener');
  try { gtag('event','open_prefilled_booking',{event_category:'Lead',event_label:service}); } catch(e){}
}

/* FORM submission */
leadForm.addEventListener('submit', async function(e){
  e.preventDefault();
  // ensure quiz capture & service present
  fldQuiz.value = JSON.stringify(state);
  fldService.value = fldService.value || computeRecommendation(state).service;

  // send via Formspree
  const fd = new FormData(leadForm);
  try {
    const resp = await fetch(leadForm.action, { method: leadForm.method, body: fd, headers: {'Accept':'application/json'} });
    if(resp.ok){
      // show confirmation area with booking link
      leadForm.style.display = 'none';
      confirmBox.style.display = '';
      // build booking link (prefill with name/email/service)
      const bookingUrl = buildBookingUrl(fd.get('name') || '', fd.get('email') || '', fd.get('service') || '');
      bookNowLink.href = bookingUrl;
      // analytics conversion event
      try { gtag('event','lead_submitted',{event_category:'Lead',event_label:fd.get('service')}); } catch(e){}
    } else {
      alert('Something went wrong. Please email DGSConsult@consultant.com');
    }
  } catch(err){
    alert('Error sending message. Please email DGSConsult@consultant.com');
  }
});

/* Build the YouCanBook.me prefilled URL — opens in new tab on click */
function buildBookingUrl(name, email, service){
  // youcanbook.me base
  const base = 'https://dgsconsulting.youcanbook.me/';
  // param names: name, email, service (as confirmed)
  const params = new URLSearchParams();
  if(name) params.set('name', name);
  if(email) params.set('email', email);
  if(service) params.set('service', service);
  return base + '?' + params.toString();
}

/* close modal on outside click and ESC */
document.addEventListener('click', (e) => { if(e.target === modal) closeModal(); });
document.addEventListener('keydown', (e) => { if(e.key === 'Escape' && modal.classList.contains('active')) closeModal(); });

/* small UX: prevent recBtn before rec shown */
recBtn.disabled = true;
</script>
</body>
</html>

